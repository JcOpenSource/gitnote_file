<attachment contenteditable="false" data-atts="%5B%5D" data-aid=".atts-a95a4b4c-8a18-44e2-8ee2-1cf4eab9f143"></attachment><h1>第4章 Flask框架入门篇</h1><p><br></p><p><br></p><p><br></p><h2>4-1 技术选型比较</h2><p><br></p><p>常见的mvc框架：</p><p><br></p><p><br></p><ul><li>Flask 轻量级</li><li>Django</li><li>Web2py</li><li>Bottle</li></ul><p><br></p><p>安装Flask</p><p><strong style="color: rgb(230, 0, 0);">pip3 install Flask</strong></p><p><br></p><p>virtualenv 虚拟环境 只有基本环境</p><p><br></p><p>[root@localhost ~]#<strong style="color: rgb(230, 0, 0);"> source imooc_env/bin/activate</strong></p><p>(imooc_env) [root@localhost ~]#&nbsp;</p><p><br></p><p><br></p><p><br></p><p><br></p><h2>外面访问网页：</h2><p>关闭防火墙：service firewalld stop</p><p><br></p><p><br></p><p>防火墙的操作</p><p><strong>关闭或禁用防火墙： service firewalld stop/disable</strong></p><p><strong>flask：</strong></p><p><strong>http://docs.jinkan.org/docs/flask/quickstart.html#a-minimal-application</strong></p><p><br></p><p><br></p><p><span style="color: rgb(62, 67, 73); background-color: rgb(250, 250, 250);">操作系统监听所有公网 IP</span></p><p><br></p><p><br></p><h1>4-4 蓝图路由规划</h1><p><br></p><p>url规划 项目越大越繁琐 路由方式有两种</p><p><br></p><p><br></p><h2>1.app 路由</h2><p><br></p><p><br></p><p><span style="color: rgb(175, 0, 219);">from</span> flask <span style="color: rgb(175, 0, 219);">import</span> Flask</p><p>app = Flask(<span style="color: rgb(0, 16, 128);">__name__</span>)</p><p><br></p><p><br></p><p>@<span style="color: rgb(121, 94, 38);">app.route</span>(<span style="color: rgb(163, 21, 21);">'/'</span>)</p><p><span style="color: rgb(0, 0, 255);">def</span> <span style="color: rgb(121, 94, 38);">hello_world</span>():</p><p><span style="color: rgb(175, 0, 219);">return</span> <span style="color: rgb(163, 21, 21);">'Hello World!'</span></p><p><br></p><p><br></p><p>@<span style="color: rgb(121, 94, 38);">app.route</span>(<span style="color: rgb(163, 21, 21);">'/api'</span>)</p><p><span style="color: rgb(0, 0, 255);">def</span> <span style="color: rgb(121, 94, 38);">index</span>():</p><p><span style="color: rgb(175, 0, 219);">return</span> <span style="color: rgb(163, 21, 21);">'api page'</span></p><p><br></p><p><br></p><p>@<span style="color: rgb(121, 94, 38);">app.route</span>(<span style="color: rgb(163, 21, 21);">'/api/hello'</span>)</p><p><span style="color: rgb(0, 0, 255);">def</span> <span style="color: rgb(121, 94, 38);">hello_api</span>():</p><p><span style="color: rgb(175, 0, 219);">return</span> <span style="color: rgb(163, 21, 21);">'api World page!'</span></p><p><br></p><p><br></p><p><span style="color: rgb(175, 0, 219);">if</span> <span style="color: rgb(0, 16, 128);">__name__</span> == <span style="color: rgb(163, 21, 21);">'__main__'</span>:</p><p>app.run(<span style="color: rgb(0, 16, 128);">host</span>=<span style="color: rgb(163, 21, 21);">'0.0.0.0'</span>)</p><p><br></p><p><br></p><p><br></p><p><br></p><h2>2 使用蓝牙方式路由</h2><p><br></p><p>跟复杂一些，但是他符合我们写代码的链接规划</p><p><br></p><p><br></p><p><br></p><p><span style="color: rgb(175, 0, 219);">from</span> flask <span style="color: rgb(175, 0, 219);">import</span> Flask</p><p><span style="color: rgb(175, 0, 219);">from</span> imooc <span style="color: rgb(175, 0, 219);">import</span> route_imooc</p><p>app = Flask(<span style="color: rgb(0, 16, 128);">__name__</span>)</p><p><br></p><p>app.register_blueprint(route_imooc, <span style="color: rgb(0, 16, 128);">url_prefix</span>=<span style="color: rgb(163, 21, 21);">"/imooc"</span>)</p><p><br></p><p><br></p><p>@<span style="color: rgb(121, 94, 38);">app.route</span>(<span style="color: rgb(163, 21, 21);">'/'</span>)</p><p><span style="color: rgb(0, 0, 255);">def</span> <span style="color: rgb(121, 94, 38);">hello_world</span>():</p><p>    <span style="color: rgb(175, 0, 219);">return</span> <span style="color: rgb(163, 21, 21);">'Hello World!'</span></p><p><br></p><p><br></p><p>@<span style="color: rgb(121, 94, 38);">app.route</span>(<span style="color: rgb(163, 21, 21);">'/api'</span>)</p><p><span style="color: rgb(0, 0, 255);">def</span> <span style="color: rgb(121, 94, 38);">index</span>():</p><p>    <span style="color: rgb(175, 0, 219);">return</span> <span style="color: rgb(163, 21, 21);">'api page'</span></p><p><br></p><p><br></p><p>@<span style="color: rgb(121, 94, 38);">app.route</span>(<span style="color: rgb(163, 21, 21);">'/api/hello'</span>)</p><p><span style="color: rgb(0, 0, 255);">def</span> <span style="color: rgb(121, 94, 38);">hello_api</span>():</p><p>    <span style="color: rgb(175, 0, 219);">return</span> <span style="color: rgb(163, 21, 21);">'api World page!'</span></p><p><br></p><p><br></p><p><span style="color: rgb(175, 0, 219);">if</span> <span style="color: rgb(0, 16, 128);">__name__</span> == <span style="color: rgb(163, 21, 21);">'__main__'</span>:</p><p>    app.run(<span style="color: rgb(0, 16, 128);">host</span>=<span style="color: rgb(163, 21, 21);">'0.0.0.0'</span>)</p><p><br></p><p>imooc.py</p><p><span style="color: rgb(175, 0, 219);">from</span> flask <span style="color: rgb(175, 0, 219);">import</span> Blueprint</p><p><br></p><p><span style="color: rgb(0, 128, 0);"># 将相似的前缀聚合在一起 就不用写那么多相似的前缀了</span></p><p><span style="color: rgb(0, 128, 0);"># 也就是保护了代码的可维护性</span></p><p><br></p><p>route_imooc = Blueprint(<span style="color: rgb(163, 21, 21);">"imooc_page"</span>, <span style="color: rgb(0, 16, 128);">__name__</span>)</p><p><br></p><p><br></p><p>@<span style="color: rgb(121, 94, 38);">route_imooc.route</span>(<span style="color: rgb(163, 21, 21);">"/"</span>)</p><p><span style="color: rgb(0, 0, 255);">def</span> <span style="color: rgb(121, 94, 38);">index</span>():</p><p>    <span style="color: rgb(175, 0, 219);">return</span> <span style="color: rgb(163, 21, 21);">"imooc index page"</span></p><p><br></p><p><br></p><p>@<span style="color: rgb(121, 94, 38);">route_imooc.route</span>(<span style="color: rgb(163, 21, 21);">"/hello"</span>)</p><p><span style="color: rgb(0, 0, 255);">def</span> <span style="color: rgb(121, 94, 38);">hello</span>():</p><p>    <span style="color: rgb(175, 0, 219);">return</span> <span style="color: rgb(163, 21, 21);">"imooc hello world"</span></p><p><br></p><p><br></p><p><br></p><h1>4-5 链接管理器和版本管理</h1><p><br></p><p><br></p><p>链接管理器 url_for</p><p>版本管理：发布生产环境中</p><p><br></p><p><br></p><p><br></p><p><br></p><p><br></p><p><br></p><h1>4-6 Flask 日志系统</h1><p><br></p><p>从服务端日志查看</p><p> msg = <span style="color: rgb(163, 21, 21);">'Hello World!url:%s, url_1:%s, url_2:%s'</span> % (url, url_1, url_2)</p><p><br></p><p>    app.logger.error(msg)</p><p>    app.logger.info(msg)</p><p>    app.logger.debug(msg)</p><p><br></p><p><br></p><p>错误处理器：  </p><p>flask.Blueprint.errorhandler</p><p>flask.Flask.errorhandler</p><p>flask.Blueprint.app_errorhandler</p><p><br></p><p>Flask发现错误，我们将错误进行捕获，使用日志系统进行输出，记录，或者更有好的提示。给生产上提供根好的用户体验</p><p>，以及放排查错误</p><p><br></p><p><br></p><p>4-8 数据库ORM</p><p>Flask-SQLAlchemy</p><p><br></p><p><strong style="color: rgb(230, 0, 0);">pip install flask_sqlalchemy</strong></p><p><strong style="color: rgb(230, 0, 0);">pip install mysqlclient</strong> (python3)</p><p><br></p><p><br></p><p><br></p><p><strong>1.&nbsp;重置数据库的root账号密码</strong></p><p><strong>a.&nbsp;</strong><strong style="color: rgb(230, 0, 0);">cat /var/log/mysqld.log |grep 'password'  查看密码</strong></p><p><strong>b. </strong><strong style="color: rgb(230, 0, 0);">SET PASSWORD = PASSWORD('LJC@0101$flask');</strong></p><p><strong style="background-color: rgb(204, 224, 245);">c.&nbsp;&nbsp;set global validate_password_policy=0;</strong></p><p><strong style="background-color: rgb(204, 224, 245);">d. set global validate<em>password</em>length=1;</strong></p><p>以上两句话是为了降低密码的要求</p><p>符合安全的密码 必须是 大写字母 + 数字 + 特殊符号</p><p><strong>e.&nbsp;</strong><strong style="color: rgb(230, 0, 0);">ALTER USER 'root'@'localhost' PASSWORD EXPIRE NEVER; </strong></p><p><strong>f.&nbsp;&nbsp;&nbsp;flush privileges; 清理权限</strong></p><p><br></p><p><br></p><p><br></p><p>(imooc_env) [root@localhost python_code]# cat /var/log/mysqld.log |grep 'password'</p><p>2019-02-18T09:11:54.165152Z 1 [Note] A temporary password is generated for root@localhost: (e6Y(w=hO#qC</p><p>2019-02-18T12:25:13.076581Z 0 [Note] Shutting down plugin 'validate_password'</p><p>2019-02-18T12:25:14.694775Z 0 [Note] Shutting down plugin 'sha256_password'</p><p>2019-02-18T12:25:14.694778Z 0 [Note] Shutting down plugin 'mysql_native_password'</p><p>2019-02-18T13:55:51.468086Z 0 [Note] Shutting down plugin 'validate_password'</p><p>2019-02-18T13:55:53.392786Z 0 [Note] Shutting down plugin 'sha256_password'</p><p>2019-02-18T13:55:53.392793Z 0 [Note] Shutting down plugin 'mysql_native_password'</p><p>(imooc_env) [root@localhost python_code]# mysql -u root -p</p><p>Enter password:&nbsp;</p><p>Welcome to the MySQL monitor.&nbsp;Commands end with ; or \g.</p><p>Your MySQL connection id is 2</p><p>Server version: 5.7.25</p><p><br></p><p>Copyright (c) 2000, 2019, Oracle and/or its affiliates. All rights reserved.</p><p><br></p><p>Oracle is a registered trademark of Oracle Corporation and/or its</p><p>affiliates. Other names may be trademarks of their respective</p><p>owners.</p><p><br></p><p>Type 'help;' or '\h' for help. Type '\c' to clear the current input statement.</p><p><br></p><p>mysql&gt; SET PASSWORD = PASSWORD(.......');</p><p>Query OK, 0 rows affected, 1 warning (0.00 sec)</p><p><br></p><p>mysql&gt; ALTER USER 'root'@'localhost' PASSWORD EXPIRE NEVER;&nbsp;</p><p>Query OK, 0 rows affected (0.00 sec)</p><p><br></p><p>mysql&gt; flush privileges;&nbsp;</p><p>Query OK, 0 rows affected (0.00 sec)</p><p><br></p><p><br></p><p><br></p><p><br></p><p><strong>.&nbsp;Flask-SQLAlchemy</strong></p><p><strong>b. </strong><strong style="color: rgb(230, 0, 0);">yum -y install mysql-devel gcc gcc-devel python-devel</strong><strong>      mysqlclient 的扩展支持</strong></p><p><strong>c.&nbsp;&nbsp;mysqlclient</strong></p><p><br></p>