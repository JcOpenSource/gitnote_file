<attachment contenteditable="false" data-atts="%5B%5D" data-aid=".atts-a95a4b4c-8a18-44e2-8ee2-1cf4eab9f143"></attachment><h1>第4章 Flask框架入门篇</h1><p><br></p><p><br></p><p><br></p><h2>4-1 技术选型比较</h2><p><br></p><p>常见的mvc框架：</p><p><br></p><p><br></p><ul><li>Flask 轻量级</li><li>Django</li><li>Web2py</li><li>Bottle</li></ul><p><br></p><p>安装Flask</p><p><strong style="color: rgb(230, 0, 0);">pip3 install Flask</strong></p><p><br></p><p>virtualenv 虚拟环境 只有基本环境</p><p><br></p><p>[root@localhost ~]#<strong style="color: rgb(230, 0, 0);"> source imooc_env/bin/activate</strong></p><p>(imooc_env) [root@localhost ~]#&nbsp;</p><p><br></p><p><br></p><p><br></p><p><br></p><h2>外面访问网页：</h2><p>关闭防火墙：service firewalld stop</p><p><br></p><p><br></p><p>防火墙的操作</p><p><strong>关闭或禁用防火墙： service firewalld stop/disable</strong></p><p><strong>flask：</strong></p><p><strong>http://docs.jinkan.org/docs/flask/quickstart.html#a-minimal-application</strong></p><p><br></p><p><br></p><p><span style="color: rgb(62, 67, 73); background-color: rgb(250, 250, 250);">操作系统监听所有公网 IP</span></p><p><br></p><p><br></p><h1>4-4 蓝图路由规划</h1><p><br></p><p>url规划 项目越大越繁琐 路由方式有两种</p><p><br></p><p><br></p><h2>1.app 路由</h2><p><br></p><p><br></p><p><span style="color: rgb(175, 0, 219);">from</span> flask <span style="color: rgb(175, 0, 219);">import</span> Flask</p><p>app = Flask(<span style="color: rgb(0, 16, 128);">__name__</span>)</p><p><br></p><p><br></p><p>@<span style="color: rgb(121, 94, 38);">app.route</span>(<span style="color: rgb(163, 21, 21);">'/'</span>)</p><p><span style="color: rgb(0, 0, 255);">def</span> <span style="color: rgb(121, 94, 38);">hello_world</span>():</p><p><span style="color: rgb(175, 0, 219);">return</span> <span style="color: rgb(163, 21, 21);">'Hello World!'</span></p><p><br></p><p><br></p><p>@<span style="color: rgb(121, 94, 38);">app.route</span>(<span style="color: rgb(163, 21, 21);">'/api'</span>)</p><p><span style="color: rgb(0, 0, 255);">def</span> <span style="color: rgb(121, 94, 38);">index</span>():</p><p><span style="color: rgb(175, 0, 219);">return</span> <span style="color: rgb(163, 21, 21);">'api page'</span></p><p><br></p><p><br></p><p>@<span style="color: rgb(121, 94, 38);">app.route</span>(<span style="color: rgb(163, 21, 21);">'/api/hello'</span>)</p><p><span style="color: rgb(0, 0, 255);">def</span> <span style="color: rgb(121, 94, 38);">hello_api</span>():</p><p><span style="color: rgb(175, 0, 219);">return</span> <span style="color: rgb(163, 21, 21);">'api World page!'</span></p><p><br></p><p><br></p><p><span style="color: rgb(175, 0, 219);">if</span> <span style="color: rgb(0, 16, 128);">__name__</span> == <span style="color: rgb(163, 21, 21);">'__main__'</span>:</p><p>app.run(<span style="color: rgb(0, 16, 128);">host</span>=<span style="color: rgb(163, 21, 21);">'0.0.0.0'</span>)</p><p><br></p><p><br></p><p><br></p><p><br></p><h2>2 使用蓝牙方式路由</h2><p><br></p><p>跟复杂一些，但是他符合我们写代码的链接规划</p><p><br></p><p><br></p><p><br></p><p><span style="color: rgb(175, 0, 219);">from</span> flask <span style="color: rgb(175, 0, 219);">import</span> Flask</p><p><span style="color: rgb(175, 0, 219);">from</span> imooc <span style="color: rgb(175, 0, 219);">import</span> route_imooc</p><p>app = Flask(<span style="color: rgb(0, 16, 128);">__name__</span>)</p><p><br></p><p>app.register_blueprint(route_imooc, <span style="color: rgb(0, 16, 128);">url_prefix</span>=<span style="color: rgb(163, 21, 21);">"/imooc"</span>)</p><p><br></p><p><br></p><p>@<span style="color: rgb(121, 94, 38);">app.route</span>(<span style="color: rgb(163, 21, 21);">'/'</span>)</p><p><span style="color: rgb(0, 0, 255);">def</span> <span style="color: rgb(121, 94, 38);">hello_world</span>():</p><p>    <span style="color: rgb(175, 0, 219);">return</span> <span style="color: rgb(163, 21, 21);">'Hello World!'</span></p><p><br></p><p><br></p><p>@<span style="color: rgb(121, 94, 38);">app.route</span>(<span style="color: rgb(163, 21, 21);">'/api'</span>)</p><p><span style="color: rgb(0, 0, 255);">def</span> <span style="color: rgb(121, 94, 38);">index</span>():</p><p>    <span style="color: rgb(175, 0, 219);">return</span> <span style="color: rgb(163, 21, 21);">'api page'</span></p><p><br></p><p><br></p><p>@<span style="color: rgb(121, 94, 38);">app.route</span>(<span style="color: rgb(163, 21, 21);">'/api/hello'</span>)</p><p><span style="color: rgb(0, 0, 255);">def</span> <span style="color: rgb(121, 94, 38);">hello_api</span>():</p><p>    <span style="color: rgb(175, 0, 219);">return</span> <span style="color: rgb(163, 21, 21);">'api World page!'</span></p><p><br></p><p><br></p><p><span style="color: rgb(175, 0, 219);">if</span> <span style="color: rgb(0, 16, 128);">__name__</span> == <span style="color: rgb(163, 21, 21);">'__main__'</span>:</p><p>    app.run(<span style="color: rgb(0, 16, 128);">host</span>=<span style="color: rgb(163, 21, 21);">'0.0.0.0'</span>)</p><p><br></p><p>imooc.py</p><p><span style="color: rgb(175, 0, 219);">from</span> flask <span style="color: rgb(175, 0, 219);">import</span> Blueprint</p><p><br></p><p><span style="color: rgb(0, 128, 0);"># 将相似的前缀聚合在一起 就不用写那么多相似的前缀了</span></p><p><span style="color: rgb(0, 128, 0);"># 也就是保护了代码的可维护性</span></p><p><br></p><p>route_imooc = Blueprint(<span style="color: rgb(163, 21, 21);">"imooc_page"</span>, <span style="color: rgb(0, 16, 128);">__name__</span>)</p><p><br></p><p><br></p><p>@<span style="color: rgb(121, 94, 38);">route_imooc.route</span>(<span style="color: rgb(163, 21, 21);">"/"</span>)</p><p><span style="color: rgb(0, 0, 255);">def</span> <span style="color: rgb(121, 94, 38);">index</span>():</p><p>    <span style="color: rgb(175, 0, 219);">return</span> <span style="color: rgb(163, 21, 21);">"imooc index page"</span></p><p><br></p><p><br></p><p>@<span style="color: rgb(121, 94, 38);">route_imooc.route</span>(<span style="color: rgb(163, 21, 21);">"/hello"</span>)</p><p><span style="color: rgb(0, 0, 255);">def</span> <span style="color: rgb(121, 94, 38);">hello</span>():</p><p>    <span style="color: rgb(175, 0, 219);">return</span> <span style="color: rgb(163, 21, 21);">"imooc hello world"</span></p><p><br></p><p><br></p><p><br></p><h1>4-5 链接管理器和版本管理</h1><p><br></p><p><br></p><p>链接管理器 url_for</p><p>版本管理：发布生产环境中</p><p><br></p><p><br></p><p><br></p><p><br></p><p><br></p><p><br></p><h1>4-6 Flask 日志系统</h1><p><br></p><p>从服务端日志查看</p><p> msg = <span style="color: rgb(163, 21, 21);">'Hello World!url:%s, url_1:%s, url_2:%s'</span> % (url, url_1, url_2)</p><p><br></p><p>    app.logger.error(msg)</p><p>    app.logger.info(msg)</p><p>    app.logger.debug(msg)</p><p><br></p><p><br></p><p>错误处理器：  </p><p>flask.Blueprint.errorhandler</p><p>flask.Flask.errorhandler</p><p>flask.Blueprint.app_errorhandler</p><p><br></p><p>Flask发现错误，我们将错误进行捕获，使用日志系统进行输出，记录，或者更有好的提示。给生产上提供根好的用户体验</p><p>，以及放排查错误</p><p><br></p><p><br></p><p><br></p><p><br></p><p><br></p><p><br></p><p><br></p><p><br></p><p><br></p><p><br></p><p><br></p><p><br></p><p><br></p><p><br></p><p><br></p><p><br></p><p><br></p>